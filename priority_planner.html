<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>공 떨어뜨리기 게임</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: #f0f0f0;
        }
        canvas {
            width: 100%;
            height: 100vh;
        }
    </style>
</head>
<body>
    <script>
        // Matter.js 모듈 설정
        const Engine = Matter.Engine,
              Render = Matter.Render,
              World = Matter.World,
              Bodies = Matter.Bodies,
              Composite = Matter.Composite,
              Common = Matter.Common;

        // 엔진 생성
        const engine = Engine.create();

        // 렌더러 생성
        const render = Render.create({
            element: document.body,
            engine: engine,
            options: {
                width: window.innerWidth,
                height: window.innerHeight,
                wireframes: false,
                background: '#f0f0f0'
            }
        });

        // 바닥과 벽 생성
        const ground = Bodies.rectangle(window.innerWidth/2, window.innerHeight, window.innerWidth, 60, { 
            isStatic: true,
            render: { fillStyle: '#666' }
        });
        const leftWall = Bodies.rectangle(0, window.innerHeight/2, 60, window.innerHeight, { 
            isStatic: true,
            render: { fillStyle: '#666' }
        });
        const rightWall = Bodies.rectangle(window.innerWidth, window.innerHeight/2, 60, window.innerHeight, { 
            isStatic: true,
            render: { fillStyle: '#666' }
        });

        // 병 모양 생성
        const bottleWidth = 300;
        const bottleHeight = window.innerHeight * 0.7;
        const wallThickness = 20;

        // 병의 각 부분 생성 (바닥과 양쪽 벽만 유지)
        const bottleBottom = Bodies.rectangle(
            window.innerWidth/2,
            window.innerHeight - 30,
            bottleWidth,
            wallThickness,
            { 
                isStatic: true, 
                render: { fillStyle: '#666' },
                density: 100,    // 밀도 증가
                friction: 0.8    // 마찰력 증가
            }
        );

        const bottleLeft = Bodies.rectangle(
            window.innerWidth/2 - bottleWidth/2 + wallThickness/2,
            window.innerHeight - bottleHeight/2,
            wallThickness,
            bottleHeight,
            { 
                isStatic: true, 
                render: { fillStyle: '#666' },
                density: 100,
                friction: 0.8
            }
        );

        const bottleRight = Bodies.rectangle(
            window.innerWidth/2 + bottleWidth/2 - wallThickness/2,
            window.innerHeight - bottleHeight/2,
            wallThickness,
            bottleHeight,
            { 
                isStatic: true, 
                render: { fillStyle: '#666' },
                density: 100,
                friction: 0.8
            }
        );

        // 월드에 객체 추가 (목 부분 관련 객체들 제거)
        World.add(engine.world, [
            ground, leftWall, rightWall,
            bottleBottom, bottleLeft, bottleRight
        ]);

        // 모래 입자 생성 함수
        function createSandParticle() {
            const x = window.innerWidth/2 + Common.random(-20, 20);
            const y = 0;
            return Bodies.circle(x, y, 2, {
                restitution: 0.3,     // 탄성 감소
                friction: 0.5,        // 마찰력 증가
                density: 0.1,         // 밀도 감소
                render: {
                    fillStyle: '#f4a460'
                }
            });
        }

        // 주기적으로 모래 입자 생성
        setInterval(function() {
            for(let i = 0; i < 3; i++) {
                const sand = createSandParticle();
                World.add(engine.world, sand);
            }
        }, 100);

        // 기존 클릭 이벤트는 유지 (더 큰 공 생성)
        document.addEventListener('click', function(event) {
            const ball = Bodies.circle(event.clientX, event.clientY, 20, {
                restitution: 0.8,
                render: {
                    fillStyle: '#' + Math.floor(Math.random()*16777215).toString(16)
                }
            });
            World.add(engine.world, ball);
        });

        // 엔진과 렌더러 실행
        Engine.run(engine);
        Render.run(render);

        // 반응형 처리
        window.addEventListener('resize', function() {
            render.canvas.width = window.innerWidth;
            render.canvas.height = window.innerHeight;
            
            // 기존 벽 위치 업데이트
            Matter.Body.setPosition(ground, { x: window.innerWidth/2, y: window.innerHeight });
            Matter.Body.setPosition(rightWall, { x: window.innerWidth, y: window.innerHeight/2 });
            
            // 병 위치 업데이트
            Matter.Body.setPosition(bottleBottom, { x: window.innerWidth/2, y: window.innerHeight - 30 });
            Matter.Body.setPosition(bottleLeft, { x: window.innerWidth/2 - bottleWidth/2 + wallThickness/2, y: window.innerHeight - bottleHeight/2 });
            Matter.Body.setPosition(bottleRight, { x: window.innerWidth/2 + bottleWidth/2 - wallThickness/2, y: window.innerHeight - bottleHeight/2 });
        });
    </script>
</body>
</html>